% Weyl5_rewrite_NatTwoR_CR_rmW.m
load('DataWeyl2_NatTwoR_CR_rmW.mat');
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% (w5.1) The w-linear terms. 5 counts after complex conjugation.
% Only need to consider W1235, W1535, W1545.
indexWlinear = [1,2,3,5; %11
    1,2,4,5; %12 //
    1,4,1,5; %31
    1,4,2,5; %35
    1,5,2,3; %45 //
    1,5,3,5; %50 
    1,5,4,5; %52 
    2,3,2,5; %68 //
    2,5,3,5; %88 //
    2,5,4,5];%90 //
W1235 = WeylTwo(11,5); 
% W1415 = WeylTwo(31,5);
% W1425 = WeylTwo(35,5);
W1535 = WeylTwo(50,5);
W1545 = WeylTwo(52,5);

wLinVector = [W1235, W1535, W1545];
yPower = [3,4,4];
printVector = [1,2,3,5;
    1,5,3,5;
    1,5,4,5];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% (w5.2) Extract the non-w-linear term in W1545.
y = 1+u*conj(u);
symVarW1545 = [Y, aV, d2aV_uMu, d2aV_uu, d2aV_uvnormv, d2w_uMu,...
    d2w_uconjMu, d2w_uu, d2w_uvnormv, d3aV_uuMu, d3w_uuMu,...
    d3w_uuu, d3w_uuvnormv, d4w_uuuMu, d4w_uuuu, daV_conjMu,...
    daV_conju, daV_u, daV_vnormv, dtheta_vnormv, dw_Mu,...
    dw_conjMu, dw_u, dw_vnormv, theta, u, w];
subSetW1545 = [1+u*conj(u), 0, 0, 0, 0, d2w_uMu, d2w_uconjMu, d2w_uu,...
    d2w_uvnormv, 0, d3w_uuMu, d3w_uuu, d3w_uuvnormv, d4w_uuuMu, d4w_uuuu,...
    0, 0, 0, 0, 0, dw_Mu, dw_conjMu, dw_u, dw_vnormv, 0, u, w];
W1545 = subs(W1545, symVarW1545, subSetW1545);
 
wSet1545 = [d2w_uMu, d2w_uconjMu, d2w_uu, d2w_uvnormv, d3w_uuMu, d3w_uuu,...
    d3w_uuvnormv, d4w_uuuMu, d4w_uuuu, dw_Mu, dw_conjMu, dw_u, dw_vnormv, w];
wSetTwo = sym('wSet',[1,28]);
for j=1:14
    wSetTwo(j) = wSet1545(j);
    wSetTwo(14+j) = conj(wSet1545(j));
end
delta1545 = i/96*(-w*d4w_uuuu + conj(w)*conj(d4w_uuuu))...
    +i/192*(d2w_uu^2 - conj(d2w_uu)^2)...
    +i/96*conj(dw_u)*conj(d3w_uuu) -i/96*dw_u*d3w_uuu...
    +i*conj(u)/(12*y)*w*d3w_uuu -i*u/(12*y)*conj(w)*conj(d3w_uuu)...
    -i*conj(u)^2/(4*y^2)*w*d2w_uu +i*u^2/(4*y^2)*conj(w)*conj(d2w_uu)...
    +i*conj(u)^3/(2*y^3)*w*dw_u -i*u^3/(2*y^3)*conj(w)*conj(dw_u)...
    +i/(2*y^4)*(u^4*conj(w)^2 - conj(u)^4*w^2);

% delta1545 = testv2 = term2 + testv3 
%   = term2 + a1*drho_u + a2*conj(drho_u) + testv4     
test1545v1 = W1545 - delta1545;
test1545v1 = complex_simple3(test1545v1, [u,wSet1545]);
[termVec, wVec] = coeffs(test1545v1, wSetTwo);
% delta1545 is okay.
  
% Replace d4w_uuuu by -i*D2rhoSub in delta1545
D2rhoSub = d2rho_uu +6*i*conj(u)/y*d3w_uuu -24*i*conj(u)^2/y^2*d2w_uu...
    + 60*i*conj(u)^3/y^3*dw_u -72*i*conj(u)^4/y^4*w...
    +12*i*conj(u)/y^3*conj(dw_u) +24*i/y^3*conj(w) -72*i*u*conj(u)/y^4*conj(w);

testv2 = subs(delta1545, d4w_uuuu, -i*D2rhoSub);
testv2 = complex_simple3(testv2, [u,wSet1545]);
% term2 is the d2rho_uu-terms in delta1545 after substitution.
term2 = -1/96*(d2rho_uu*w + conj(d2rho_uu)*conj(w));

testv3 = testv2 - term2;
% Replace d3w_uuu by -i*DrhoSub
DrhoSub = drho_u + 6*i*conj(u)/y*d2w_uu - 18*i*conj(u)^2/y^2*dw_u...
    +24*i*conj(u)^3/y^3*w -6*i/y^2*conj(dw_u) +24*i*u/y^3*conj(w);
testv3 = subs(testv3, d3w_uuu, -i*DrhoSub);
testv3 = complex_simple3(testv3, [u,wSet1545,drho_u]);
[termv3, rhov3] = coeffs(testv3, [drho_u, conj(drho_u)]);
termv3(1) = complex_simple3(termv3(1),[u,wSet1545]);
termv3(2) = complex_simple3(termv3(2),[u,wSet1545]);

testv4 = complex_simple3(termv3(3),[u,wSet1545]);

syms phiW0
testv4 = subs(testv4, d2w_uu, phiW0+6*conj(u)/y*dw_u-12*conj(u)^2/y^2*w);
testv4 = complex_simple3(testv4,[u, w, dw_u, phiW0]);

% check that delta1545 is correctly simplified
Rho = i*phiW - i*conj(phiW);

dRho_u = i*d3w_uuu - 6*i*conj(u)/y*d2w_uu + 18*i*conj(u)^2/y^2*dw_u...
    -24*i*conj(u)^3/y^3*w + 6*i/y^2*conj(dw_u) -24*i*u/y^3*conj(w);
d2Rho_uu = i*d4w_uuuu -6*i*conj(u)/y*d3w_uuu +24*i*conj(u)^2/y^2*d2w_uu...
    - 60*i*conj(u)^3/y^3*dw_u +72*i*conj(u)^4/y^4*w...
    -12*i*conj(u)/y^3*conj(dw_u) -24*i/y^3*conj(w) +72*i*u*conj(u)/y^4*conj(w);
myTest = -1/96*(w*d2Rho_uu +conj(w)*conj(d2Rho_uu))...
    -1/96*(dw_u-2*conj(u)/y*w)*dRho_u -1/96*(conj(dw_u)-2*u/y*conj(w))*conj(dRho_u)...
    +i/192*(phiW^2 - conj(phiW)^2);
myDiff = myTest - delta1545;
myDiff = complex_simple3(myDiff,[u,wSet1545]);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Print the w-linear terms
latexFile = fopen('latex_wLinear_Nov3.txt','w');
for j=1:3
     myNumber = yPower(j);
     temp = (Y^myNumber)*wLinVector(j);
     [termVec, yVec] = coeffs(temp,[Y]);
     myLength = length(yVec);
     rowTemp = printVector(j,:);
     fprintf(latexFile,'$Y^{%d}\\cdot \\mbox{W}(u_%d, u_%d, u_%d, u_%d)$: \\\\ \n',...
         [myNumber,rowTemp]);
     fprintf(latexFile, '%s\n', ' ');
     for k = 1:myLength
         yTemp = yVec(k);
         termTemp = termVec(k);
         fprintf(latexFile,'term $ %s $: \\\\ \n', latex(yTemp));
         fprintf(latexFile, '%s\n', ' ');
         fprintf(latexFile,'$ %s $ \\\\[0.1in] \n', latex(termTemp));
         fprintf(latexFile, '%s\n', ' ');  
     end
     fprintf(latexFile, '\\newpage \n'); 
     fprintf(latexFile, '%s\n', ' '); 
end
fclose(latexFile);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% (w5.3) check W1235
load('DataWeylTwo_NatTwoR_CR_rmW.mat');
W1235 = WeylTwo(11,5); 
W1535 = WeylTwo(50,5);
W1545 = WeylTwo(52,5);
y = 1+u*conj(u);

W1235 = subs(W1235,Y,y);
% rhoSub
dRho_u = i*d3w_uuu - 6*i*conj(u)/y*d2w_uu + 18*i*conj(u)^2/y^2*dw_u...
    -24*i*conj(u)^3/y^3*w + 6*i/y^2*conj(dw_u) -24*i*u/y^3*conj(w)...
    +12*i*daV_u -12*i*conj(daV_conju);

partOne1235 = 1/24*conj(dRho_u)*conj(w) -i/12*d3w_uuconjMu -i/24*conj(d3w_uuMu)...
    +i/4*conj(d2w_uvnormv) -y^2/24*(2*theta+i*aV-i*conj(aV))*d3w_uuu...
    +i*u/(4*y)*conj(d2w_uMu)+i*conj(u)/(2*y)*d2w_uconjMu...
    -i*u/y*conj(dw_vnormv)+i*y^2/8*conj(d2w_uu)*conj(daV_conju)...
    +conj(u)*y/4*(2*theta+i*aV-i*conj(aV))*d2w_uu...
    -i/(2*y^2)*conj(dw_conjMu) -i*u^2/(2*y^2)*conj(dw_Mu)...
    -i*conj(u)^2/y^2*dw_conjMu +3*i*y^2/8*dw_u*d2aV_uu...
    +3*i*conj(u)*y/4*dw_u*daV_u -3*i*u*y/4*conj(dw_u)*conj(daV_conju)...
    -3*conj(u)^2/4*(2*theta+i*aV-i*conj(aV))*dw_u...
    +(1/2*theta+i/4*aV)*conj(dw_u) -3*i*conj(u)*y/2*w*d2aV_uu...
    -3*i*conj(u)^2*w*daV_u...
    +(3*i*u^2/2*conj(daV_conju)+i*conj(daV_u)-i/2*daV_conju)*conj(w)...
    +conj(u)^3/y*(2*theta+i*aV-i*conj(aV))*w -u/y*(2*theta+i*aV)*conj(w);

partTwo1235 = -3*i*y^4/16*(daV_conju+conj(daV_u))*d2aV_uu...
    +i*conj(u)*y^3/8*(-5*daV_u*daV_conju+2*conj(daV_conju)*conj(daV_u)-3*daV_u*conj(daV_u))...
    +5*i*y^2/16*d3aV_uuMu +i*y^2/8*d2aV_uvnormv -i*y^2/4*conj(d2aV_conjuvnormv)...
    +i*y^2/8*conj(aV)*daV_u-y^2*(theta+5*i/8*aV-i/2*conj(aV))*conj(daV_conju)...
    +5*i*conj(u)*y/8*d2aV_uMu +i*conj(u)*y/4*d2aV_conjuconjMu...
    -i*conj(u)*y/4*conj(d2aV_conjuconjMu)-i*conj(u)*y/2*daV_vnormv...
    +i*conj(u)*y/2*conj(daV_vnormv)-conj(u)*y*dtheta_vnormv...
    -conj(u)*y/2*(aV+conj(aV))*(2*theta+i*aV-i*conj(aV))...
    -3*i/8*daV_conjMu +i/4*conj(daV_Mu) -1/3*dtheta_conjMu;

test1235 = W1235 -partOne1235 -partTwo1235;
test1235 = complex_simple3(test1235, symSetWeylTwo);
% set1235 = symvar(test1235);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
W1535 = subs(W1535, Y, y);

partOne1535 = -1/(12*y^2)*conj(w)*rhoSub -i/48*d4w_uuuconjMu...
   +i*conj(u)/(8*y)*d3w_uuconjMu -i*y^2/48*d3w_uuu*daV_u...
   -3*i*conj(u)^2/(8*y^2)*d2w_uconjMu +i/(8*y^2)*conj(d2w_uMu)...
   +5*i*y^2/48*d2w_uu*d2aV_uu +i*y^2/48*conj(d2w_uu)*d2aV_uu...
   +i*conj(u)*y/3*d2w_uu*daV_u +i*conj(u)*y/24*conj(d2w_uu)*daV_u...
   +i*conj(u)^3/(2*y^3)*dw_conjMu -i*u/(2*y^3)*conj(dw_Mu) -i/y^2*conj(dw_vnormv)...
   -5*i*conj(u)*y/8*dw_u*d2aV_uu -i*y/8*(u*d2aV_uu+2*daV_u)*conj(dw_u)...
   -13*i*conj(u)^2/8*dw_u*daV_u+(3*i/8*daV_u-i/2*conj(daV_conju))*conj(dw_u)...
   +5*i*conj(u)^2/4*w*d2aV_uu+i/4*(u^2*d2aV_uu+2*u*daV_u)*conj(w)...
   +3*i*conj(u)^3/y*w*daV_u+i*u/y*(-daV_u+2*conj(daV_conju))*conj(w)...
   +1/y^2*(theta+i*aV-2*i*conj(aV))*conj(w);

partTwo1535 = -3*i*conj(u)*y^3/32*(daV_conju+conj(daV_u))*d2aV_uu...
    +i*y^2/2*d3aV_uuvnormv...
    +y^2*(theta/6+i/2*conj(aV))*d2aV_uu +i*y^2/2*(conj(daV_conju))^2 ...
    -i*y^2/2*daV_u*conj(daV_conju)-3*i*conj(u)^2*y^2/16*daV_u*daV_conju...
    -3*i*conj(u)^2*y^2/16*daV_u*conj(daV_u) +3*i*conj(u)*y/32*d3aV_uuMu...
    +13*i*conj(u)*y/16*d2aV_uvnormv +conj(u)*y*(theta/3+13*i/16*conj(aV))*daV_u...
    +3*i*conj(u)*y/16*aV*conj(daV_conju) +3*i*conj(u)^2/16*d2aV_uMu...
    -3*i*conj(u)/(16*y)*daV_conjMu;

test1535 = W1535 -partOne1535 -partTwo1535;
test1535 = complex_simple3(test1535, symSetWeylTwo);
set1535 = symvar(test1535);      
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
W1545 = subs(W1545,Y,y);
% dRho_u = i*d3w_uuu - 6*i*conj(u)/y*d2w_uu + 18*i*conj(u)^2/y^2*dw_u...
%     -24*i*conj(u)^3/y^3*w + 6*i/y^2*conj(dw_u) -24*i*u/y^3*conj(w)...
%     +12*i*daV_u -12*i*conj(daV_conju);
d2Rho_uu = i*d4w_uuuu -6*i*conj(u)/y*d3w_uuu +24*i*conj(u)^2/y^2*d2w_uu...
    - 60*i*conj(u)^3/y^3*dw_u +72*i*conj(u)^4/y^4*w...
    -12*i*conj(u)/y^3*conj(dw_u) -24*i/y^3*conj(w) +72*i*u*conj(u)/y^4*conj(w)...
    +24*i*d2aV_uu +24*i*conj(u)/y*(conj(daV_conju)+daV_u);

partOne1545 = -1/96*(w*d2Rho_uu+conj(w)*conj(d2Rho_uu))...
    -1/96*(dw_u-2*conj(u)/y*w)*dRho_u -1/96*(conj(dw_u)-2*u/y*conj(w))*conj(dRho_u)...
    +rhoSub/192*(phiW+conj(phiW))...
    -i/96*d4w_uuuMu +i/96*conj(d4w_uuuMu)+i*conj(u)/(16*y)*d3w_uuMu...
    -i*u/(16*y)*conj(d3w_uuMu) ...
    +i/24*d3w_uuvnormv -i/24*conj(d3w_uuvnormv)...
    +i*y^2/32*daV_conju*d3w_uuu -i*y^2/32*conj(daV_conju)*conj(d3w_uuu)...
    -(theta/12+i/16*aV-i/16*conj(aV))*(phiW+conj(phiW))...
    +i/(4*y)*(u*conj(d2w_uvnormv) -conj(u)*d2w_uvnormv)...
    +i/(16*y^2)*(conj(d2w_uconjMu)-d2w_uconjMu)...
    +3*i/(16*y^2)*(u^2*conj(d2w_uMu)-conj(u)^2*d2w_uMu)...
    -3*i*conj(u)*y/16*d2w_uu*daV_conju +3*i*u*y/16*conj(d2w_uu)*conj(daV_conju)...
    +i/24*aV*(d2w_uu-conj(d2w_uu))-theta/12*conj(d2w_uu)+i*conj(u)^2/(2*y^2)*dw_vnormv...
    -i*u^2/(2*y^2)*conj(dw_vnormv)...
    +i/(4*y^3)*(conj(u)*dw_conjMu-u*conj(dw_conjMu)+conj(u)^3*dw_Mu -u^3*conj(dw_Mu));

partTwo1545 = (i/8*daV_u-3*i/16*conj(daV_conju)+9*i*conj(u)^2/16*daV_conju)*dw_u...
    +(3*i/16*daV_conju-i/8*conj(daV_u)-9*i*u^2/16*conj(daV_conju))*conj(dw_u)...
    -i*conj(u)/(4*y)*aV*dw_u +u/(4*y)*(2*theta+i*aV)*conj(dw_u)...
    +i/4*w*d2aV_uu -i/4*conj(w)*conj(d2aV_uu)...
    +3*i/(4*y)*(conj(u)*conj(daV_conju)-conj(u)^3*daV_conju)*w...
    +3*i/(4*y)*(u^3*conj(daV_conju)-u*daV_conju)*conj(w)...
    +i*conj(u)^2/(2*y^2)*aV*w -u^2/(2*y^2)*(2*theta+i*aV)*conj(w);

partThree1545 = 3*i*y^3/16*(daV_u*daV_conju+daV_u*conj(daV_u))...
    +3*i*u*y^3/32*(daV_conju+conj(daV_u))*d2aV_uu...
    +i*y^2/16*daV_u*daV_conju -3*i*y^2/16*daV_u*conj(daV_u)...
    -i*y^2/4*conj(daV_u)*conj(daV_conju)...
    -3*i*u*y/32*d3aV_uuMu -3*i*y/16*d2aV_uMu +3*i*u*y/16*d2aV_uvnormv...
    +3*i*u*y/16*(conj(aV)*daV_u-aV*conj(daV_conju))...
    +3*i/16*d2aV_uMu +2/3*dtheta_vnormv +i/2*daV_vnormv...
    -i/2*conj(daV_vnormv) +3*i*u/(16*y)*daV_conjMu...
    -2*i/3*theta^2 +7/6*theta*aV -1/2*theta*conj(aV)...
    +i/2*aV^2 -i/2*aV*conj(aV);

test1545 = W1545 -partOne1545 -partTwo1545 -partThree1545;
test1545 = complex_simple3(test1545, symSetWeylTwo);
% set1545 = symvar(test1545);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%